@using DataModels.VM.AircraftEquipment;
@using DataModels.Enums;

<div class="row mb-4">
    <div class="col">
        <h2 style="float:left">Manage Aircraft Equipment Details</h2>
        @if (_currentUserPermissionManager.IsAllowed(AuthStat, PermissionType.Create, @moduleName) && isAllowToEdit)
        {
             <TelerikButton Class="btn k-btn-primary" ThemeColor="primary" OnClick="() => AircraftEquipmentCreateDialog(new AircraftEquipmentDataVM())" Enabled="@(!isBusyAddButton)">
                            <TelerikLoader Class="button-loader-indicator" Size="sm" ThemeColor="light" Visible="@isBusyAddButton">
                            </TelerikLoader>
                            <CustomIcons IconName="add" PrimaryColor="White"></CustomIcons> Add
                        </TelerikButton>
        }
    </div>
</div>

<TelerikGrid TItem="AircraftEquipmentDataVM" OnRead="@LoadData" Pageable="true" @ref="@grid"
             Sortable="true" PageSize="@pageSize" PageSizeChanged="@PageSizeChangedHandler">

    <GridSettings>
        <Web.UI.Shared.Components.TelerikGridPager.TelerikGridPagerComponent></Web.UI.Shared.Components.TelerikGridPager.TelerikGridPagerComponent>
    </GridSettings>

    <GridColumns>

        <GridColumn Field="@nameof(AircraftEquipmentDataVM.Status)" Title="Status" Sortable="true"></GridColumn>
        <GridColumn Field="@nameof(AircraftEquipmentDataVM.Item)" Title="Item" Sortable="true"></GridColumn>
        <GridColumn Field="@nameof(AircraftEquipmentDataVM.Classification)" Title="Classification" Sortable="true"></GridColumn>
        <GridColumn Field="@nameof(AircraftEquipmentDataVM.Make)" Title="Make" Sortable="true"></GridColumn>
        <GridColumn Field="@nameof(AircraftEquipmentDataVM.Model)" Title="Model" Sortable="true"></GridColumn>

        <GridCommandColumn Context="dataItem" Title="Action">
            @{
               AircraftEquipmentDataVM data = dataItem as AircraftEquipmentDataVM;

                @if (_currentUserPermissionManager.IsAllowed(AuthStat, PermissionType.Edit, moduleName))
                {
                    <TelerikButton Class="btn k-btn-grid-edit mx-1" OnClick="()=>AircraftEquipmentCreateDialog(data)"
                           ThemeColor="success" Enabled=!data.IsLoadingEditButton>

                        <CustomIcons IconName="grid-edit" PrimaryColor="white"></CustomIcons>
                        <TelerikLoader Class="button-loader-indicator" Size="sm" ThemeColor="light"
                               Visible="data.IsLoadingEditButton">
                        </TelerikLoader>

                    </TelerikButton>
                }

                @if (_currentUserPermissionManager.IsAllowed(AuthStat, PermissionType.Delete, moduleName))
                {
                    <TelerikButton Class="btn k-btn-grid-delete mx-1" ThemeColor="error" OnClick="()=>OpenDeleteDialog(data)">
                        <CustomIcons IconName="grid-delete" PrimaryColor="white"></CustomIcons>
                    </TelerikButton>
                }
            }
        </GridCommandColumn>

    </GridColumns>

</TelerikGrid>

@if (isDisplayPopup)
{
    <CustomPopupComponent Title="@popupTitle"
                      HeaderCssClass=@CustomPopupComponent.GetHeaderCssClass(operationType)
                      CloseOnOutsideClick="false" Width="600px"
                      OnClose="@(()=> {isDisplayPopup = false;})">
        <Body>

            @if (operationType == OperationType.Create || operationType == OperationType.Edit)
            {
                <Web.UI.Pages.Aircraft.DetailsTabs.AircraftEquipment.Create AircraftEquipmentsVM=@aircraftEquipmentsVM CloseDialogCallBack="@CloseDialog">
                </Web.UI.Pages.Aircraft.DetailsTabs.AircraftEquipment.Create>

            }
            else if(operationType == OperationType.Delete)
            {
                //Delete popup
                <div>
                    <p class="mb-4">Are you sure, You want to delete <b> @aircraftEquipmentsVM.Item </b>?</p>
                    <div class="row" style="text-align:right">
                        <div class="col">

                             <TelerikButton Class="btn k-btn-danger" ThemeColor="error" OnClick="()=>DeleteAsync(aircraftEquipmentsVM.Id)">
                                    Yes
                                </TelerikButton>

                                   <TelerikButton Class="btn k-btn-secondary" ThemeColor="secondary" OnClick="()=>isDisplayPopup = false">
                                No
                            </TelerikButton>
                        </div>
                    </div>
                </div>
            }
        </Body>
    </CustomPopupComponent>
}

